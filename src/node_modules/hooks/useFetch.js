import { useState, useEffect } from "react";

export default (url) => {
    const _baseUrl = 'https://conduit.productionready.io/api';
    const [isLoaiding, setIsLoading] = useState(false);
    const [response, setResponse] = useState(null);
    const [error , setError] = useState(null);
    const [options , setOptions] = useState({});

    const doFetch = (options = {}) => {
        setOptions(options);
        setIsLoading(true);
    }

    useEffect(async() => {
        if(!isLoaiding) {
            return;
        }
        try {

            const res = await fetch(`${_baseUrl}${url}`, options)
            .then(async (res) => {
                const json = await res.json();
                const result = await JSON.stringify(json);
                setResponse(result);
                setIsLoading(false);
            })
            .catch( (error) => {
                setIsLoading(false);
                setError(error)
            });
           
        } catch(e) {
            console.log('Ошибка:',e)
        }
    }, [isLoaiding]);
    return [{isLoaiding, response, error}, doFetch];
}