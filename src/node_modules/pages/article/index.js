import React, {useEffect, useContext} from 'react';
import useFetch from 'hooks/useFetch';
import { Link } from 'react-router-dom';
import Loading from 'components/loading';
import ErrorText from 'components/error';
import TagList from 'components/tagList';
import { CurrentUserContext } from 'contexts/currentUser';
import './index.css';


const Article = (props) => {
    const [currentUserState] = useContext(CurrentUserContext);
    const slug = props.match.params.slug;
    const apiUrl = `/articles/${slug}`
    const [{response, error, isLoading}, doFetch] = useFetch(apiUrl);

    useEffect(() => {
        doFetch();
    }, []);
    return (
        <div className="artcile-page">
            <div className="banner">
                {!isLoading && response && (
                    <div className="container">
                        <h1>{response.article.title}</h1>
                        <div className="article-meta">
                           <Link to={`/profiles/${response.article.author.username}`}>
                               <img src={response.article.author.image} alt="" />
                           </Link>
                           <div className="info">
                                <Link to={`/profiles/${response.article.author.username}`}>
                                   {response.article.author.username}
                                </Link>
                                <span className="date">{response.article.updatedAt}</span>
                           </div>
                        </div>
                    </div>
                )}
            </div>
            <div className="container page">
                {isLoading && <Loading/>}
                {error && <ErrorText/>}
                {!isLoading && response && (
                    <>
                        <div className="row article-content">
                            <div className="col-xs-12">
                                <div>
                                    <p>{response.article.body}</p>
                                </div>
                                <TagList tags={response.article.tagList}/>
                            </div>
                        </div>
                        <hr />
                        <div className="article-actions">
                            <div className="article-meta">
                                <Link to={`/profiles/${response.article.author.username}`}>
                                    <img src={response.article.author.image} alt="" />
                                </Link>
                                <div className="info">
                                    <Link to={`/profiles/${response.article.author.username}`}>
                                    {response.article.author.username}
                                    </Link>
                                    <span className="date">{response.article.updatedAt}</span>
                                </div>
                            </div>
                        </div>
                        {!currentUserState.isLoggedIn && (
                            <div className="row">
                                <div className="col-xs-12 col-md-8 offset-md-2">
                                    <p>
                                        <Link to='/login'>Sign in</Link>
                                        &nbsp;or&nbsp;  
                                        <Link to='/register'>sign up</Link>
                                        &nbsp;to add comments on this article.
                                    </p>
                                </div>
                            </div>
                        )}
                    </>
                )}
            </div>
        </div>
    )
}

export default Article;