import React, {useContext}from 'react';
import useFetch from 'hooks/useFetch';
import classNames from 'classnames';
import { CurrentUserContext } from 'contexts/currentUser';
import { Redirect } from 'react-router-dom';

const AddToFavotites = ({isFavorited, favoritesCount, articleSlug}) => {
    const apiUrl = `/articles/${articleSlug}/favorite`;
    const [currentUserState] = useContext(CurrentUserContext);
    const [{response}, doFetch] = useFetch(apiUrl);
    const favoritesCountWithResponse = response ? response.article.favoritesCount : favoritesCount;
    const favoritedWithResponse = response ? response.article.favorited : isFavorited;
    const buttonClasses = classNames({
        'btn': true,
        'btn-sm': true,
        'btn-primary': favoritedWithResponse,
        'btn-outline-primary': !favoritedWithResponse
    })
    const handleLike = e => {
        e.preventDefault();

        if(currentUserState.isLoggedIn) {
            doFetch({
                method: favoritedWithResponse ? 'delete' : 'post'
            })
        } else {
            return <Redirect to='/login'/>
        }
    }
    return (
        <button className={buttonClasses} onClick={handleLike}>
            <i className="ion-heart"></i>
            <span>&nbsp; {favoritesCountWithResponse}</span>
        </button>
    )
}

export default AddToFavotites;